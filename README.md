# UDP通信测试项目

这是一个用于Orin机器与TC3开发板之间进行UDP通信的C语言项目，包含性能测试功能。

## 功能特性

- ✅ UDP发送模式：向TC3发送UDP报文
- ✅ UDP接收模式：从TC3接收UDP报文
- ✅ 性能测试模式（延迟、吞吐量、丢包率）
- ✅ 多轮迭代测试：支持多轮测试并计算平均值和标准差
- ✅ 交互式通信模式
- ✅ 实时统计信息显示
- ✅ 可配置的端口和IP地址
- ✅ 支持最大UDP数据包测试（默认）

## 项目结构

```
udp_comm/
├── include/
│   └── common.h          # 公共头文件
├── src/
│   ├── common.c          # 公共函数实现
│   ├── server.c          # UDP服务器（接收来自TC3的UDP报文）
│   └── client.c          # UDP客户端（发送UDP报文到TC3）
├── Makefile              # 编译脚本
└── README.md            # 说明文档
```

## 编译

```bash
cd udp_comm
make
```

编译后的可执行文件位于 `bin/` 目录：
- `bin/udp_server` - UDP服务器程序（接收来自TC3的UDP报文）
- `bin/udp_client` - UDP客户端程序（发送UDP报文到TC3）

## 使用方法

### 1. 接收模式（从TC3接收UDP报文）

使用 `udp_server` 接收来自TC3的UDP报文：

```bash
# 接收模式（绑定到所有接口）
./bin/udp_server -i 0.0.0.0 -p 8888

# 接收模式 + 性能测试模式（统计接收性能）
./bin/udp_server -i 0.0.0.0 -p 8888 -t

# 指定绑定IP地址
./bin/udp_server -i 192.168.1.50 -p 8888 -t
```

### 2. 发送模式（向TC3发送UDP报文）

使用 `udp_client` 向TC3发送UDP报文：

```bash
# 交互式发送模式
./bin/udp_client -i <TC3_IP地址> -p 8888

# 性能测试模式（发送1000个最大UDP包）
./bin/udp_client -i <TC3_IP地址> -p 8888 -t -n 1000 -s 0

# 多轮迭代测试（10轮，每轮1000个包，计算平均值）
./bin/udp_client -i 192.168.1.100 -p 8888 -t -n 1000 -s 0 -r 10

# 自定义包大小和数量
./bin/udp_client -i 192.168.1.100 -p 8888 -t -n 5000 -s 2048
```

### 3. 命令行参数说明

#### udp_server 参数（接收程序）
- `-h` : 显示帮助信息
- `-p <port>` : 指定端口号（默认: 8888）
- `-i <ip>` : 指定绑定的IP地址（默认: 0.0.0.0，表示监听所有接口）
- `-t` : 启用性能测试模式（统计延迟、丢包率等）

#### udp_client 参数（发送程序）
- `-h` : 显示帮助信息
- `-p <port>` : 指定TC3端口号（默认: 8888）
- `-i <ip>` : 指定TC3 IP地址（必需）
- `-t` : 启用性能测试模式
- `-n <count>` : 测试数据包数量（默认: 1000）
- `-s <size>` : 数据包大小（字节，0或不设置 = 最大UDP包，默认: 0）
- `-r <iterations>` : 多轮迭代测试次数（默认: 1）

## 性能测试指标

程序会自动统计并显示以下性能指标：

1. **延迟指标**
   - 最小延迟（ms）
   - 最大延迟（ms）
   - 平均延迟（ms）

2. **吞吐量指标**
   - 发送字节数（MB）
   - 接收字节数（MB）
   - 平均吞吐量（Mbps）

3. **可靠性指标**
   - 发送数据包数
   - 接收数据包数
   - 丢失数据包数
   - 丢包率（%）

4. **时间指标**
   - 测试总时长（秒）

## 使用示例

### 示例1：向TC3发送UDP报文

```bash
# 交互式发送
./bin/udp_client -i 192.168.1.100 -p 8888

# 性能测试：发送1000个最大UDP包到TC3
./bin/udp_client -i 192.168.1.100 -p 8888 -t -n 1000 -s 0

# 多轮迭代测试：10轮，每轮1000个最大UDP包，计算平均值
./bin/udp_client -i 192.168.1.100 -p 8888 -t -n 1000 -s 0 -r 10
```

### 示例2：从TC3接收UDP报文

```bash
# 接收模式：等待接收来自TC3的UDP报文
./bin/udp_server -i 0.0.0.0 -p 8888 -t
```

### 示例3：本机测试（单机测试）

在Orin本机上进行测试，使用本地回环地址 `127.0.0.1`：

**终端1 - 启动接收端：**
```bash
./bin/udp_server -i 127.0.0.1 -p 8888 -t
```

**终端2 - 启动发送端（在同一台机器上）：**
```bash
# 性能测试模式（发送最大UDP包）
./bin/udp_client -i 127.0.0.1 -p 8888 -t -n 1000 -s 0

# 多轮迭代测试
./bin/udp_client -i 127.0.0.1 -p 8888 -t -n 1000 -s 0 -r 10
```

## 清理编译文件

```bash
make clean
```

## 安装/卸载

```bash
# 安装到系统路径
make install

# 卸载
make uninstall
```
